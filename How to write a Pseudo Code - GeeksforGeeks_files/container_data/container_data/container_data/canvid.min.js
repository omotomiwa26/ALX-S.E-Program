!function(e,n){"undefined"!=typeof module&&module.exports?module.exports=n():"function"==typeof define&&define.amd?define([],n):e.canvid=n()}(this,function(){return function(e){var n,E=!0,C={play:function(){console.log("Cannot play before images are loaded")}},F=function(){for(var e,n={},o=0;o<arguments.length;o++)for(e in arguments[o])arguments[o].hasOwnProperty(e)&&(n[e]=arguments[o][e]);return n}({width:800,height:450,selector:".canvid-wrapper"},e),b="string"==typeof F.selector?document.querySelector(F.selector):F.selector;if(!b)return console.warn("Error. No element found for selector",F.selector);if(!F.videos)return console.warn("Error. You need to define at least one video object");if((n=document.createElement("canvas")).getContext&&n.getContext("2d"))!function(e,n){var o={},t=Object.keys(e).length;if(0===t)return n("You need to define at least one video object.");for(var r in e)o[r]=new Image,o[r].onload=i,o[r].onerror=n,o[r].src=e[r].src;function i(){0===--t&&n(null,o)}}(F.videos,function(e,v){if(e)return console.warn("Error while loading video sources.",e);var n,g=((n=document.createElement("canvas")).width=F.width,n.height=F.height,n.classList.add("canvid"),b.appendChild(n),n.getContext("2d")),y=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return setTimeout(e,1e3/60)};C.play=function(e,n){C.pause&&C.pause();for(var o=v[e],t=F.videos[e],r=o.width/t.cols,i=o.height/Math.ceil(t.frames/t.cols),a=n||t.fps||15,s=0,c=0,l=!0,u=0,d=60/a,f=[],m=[],h=0;h<=t.frames;h++)f.push(Math.floor(h%t.cols)*r),m.push(Math.floor(h/t.cols)*i);function p(){c||(w(f[s],m[s]),(s=+s+1)>t.cols&&s<0&&(s+=+t.frames),s>=t.frames&&(s=0),s||u++,t.loops&&u>=t.loops&&(l=!1,t.onEnd&&q(t.onEnd)&&t.onEnd())),c=(c+1)%d,l&&1<t.frames&&y(p)}function w(e,n){g.drawImage(o,e,n,r,i,0,0,F.width,F.height)}y(p),C.resume=function(){l=!0,y(p)},C.pause=function(){l=!1,y(p)},C.isPlaying=function(){return l},C.destroy=function(){C.pause(),[].forEach.call(b.children,function(e){e.classList.contains("canvid")&&b.removeChild(e)})},C.getCurrentFrame=function(){return s},C.setCurrentFrame=function(e){if(e<0||e>=t.frames)return!1;C.isPlaying()||w(f,m),s=e},E&&(E=!1,[].forEach.call(b.children,function(e){e.classList.contains("canvid")||(e.style.display="none")}))},q(F.loaded)&&F.loaded(C)});else if(opts.srcGif){var o=new Image;o.src=opts.srcGif,b.appendChild(o)}function q(e){return"function"==typeof e||e&&e.constructor&&e.call&&e.apply}return C}});